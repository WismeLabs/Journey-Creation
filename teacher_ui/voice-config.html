<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice & Speaker Configuration - Journey Creation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #3498db, #2980b9);
            padding: 30px;
            color: white;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .persistence-notice {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 30px;
            color: #856404;
            font-size: 14px;
            line-height: 1.6;
        }

        .persistence-notice strong {
            color: #533f03;
            font-size: 16px;
        }

        .config-section {
            padding: 30px;
            border-bottom: 1px solid #eee;
        }

        .config-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 1.8em;
            color: #2c3e50;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .speaker-config {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .speaker-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .speaker-card:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .speaker-card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .voice-preview {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .audio-controls {
            background: #f1f3f4;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .slider-group {
            margin-bottom: 15px;
        }

        .slider-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
        }

        .value-display {
            float: right;
            color: #666;
            font-weight: 500;
        }

        .actions {
            background: #f8f9fa;
            padding: 30px;
            text-align: center;
            border-top: 1px solid #eee;
        }

        .actions .btn {
            margin: 0 10px;
            padding: 15px 30px;
            font-size: 16px;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .voice-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 10px;
        }

        .voice-option {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .voice-option:hover {
            background-color: #f8f9fa;
        }

        .voice-option.selected {
            background-color: #e3f2fd;
            border-left: 4px solid #3498db;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ddd;
            border-radius: 50%;
            border-top-color: #3498db;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .nav-bar {
            background: #2c3e50;
            padding: 0;
            display: flex;
            justify-content: center;
            gap: 0;
        }

        .nav-bar a {
            color: white;
            text-decoration: none;
            padding: 15px 25px;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-bar a:hover {
            background: #34495e;
        }

        .nav-bar a.active {
            background: #34495e;
            border-bottom-color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé§ Voice & Speaker Configuration</h1>
            <p>Customize speaker names, voices, and audio parameters for your educational content</p>
        </div>

        <div class="persistence-notice">
            <strong>üíæ Global Default Settings</strong><br>
            These settings will be <strong>saved permanently</strong> and used as defaults for all future chapter uploads.<br>
            You can preview these settings on the Upload page before generating content.
        </div>

    <div class="nav-bar">
        <a href="upload.html">üì§ Upload Chapter</a>
        <a href="voice-config.html" class="active">üé§ Voice Settings</a>
        <a href="https://cloud.google.com/text-to-speech/docs/voices" target="_blank">üéß Preview Voices</a>
        <a href="review.html">üìù Review Content</a>
        <a href="logs.html">üìä System Logs</a>
    </div>        <div id="statusMessage" class="status-message"></div>

        <!-- Speaker Configuration Section -->
        <div class="config-section">
            <h2 class="section-title">
                üë• Speaker Configuration
            </h2>
            
            <div class="speaker-config">
                <!-- Speaker 1 -->
                <div class="speaker-card">
                    <h3>üé≠ Speaker 1 (Primary)</h3>
                    
                    <div class="form-group">
                        <label for="speaker1Name">Display Name</label>
                        <input type="text" id="speaker1Name" placeholder="e.g., Sarah, Ms. Johnson, Alex" value="StudentA">
                    </div>
                    
                    <div class="form-group">
                        <label for="speaker1Role">Role</label>
                        <select id="speaker1Role">
                            <option value="student">Student</option>
                            <option value="teacher">Teacher</option>
                            <option value="narrator">Narrator</option>
                            <option value="host">Host</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="speaker1Personality">Personality</label>
                        <select id="speaker1Personality">
                            <option value="confident">Confident</option>
                            <option value="friendly">Friendly</option>
                            <option value="professional">Professional</option>
                            <option value="enthusiastic">Enthusiastic</option>
                            <option value="calm">Calm</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="speaker1Voice">Voice Selection</label>
                        <select id="speaker1Voice">
                            <option value="">Loading voices...</option>
                        </select>
                        <div class="voice-preview">
                            <button type="button" class="btn btn-secondary" onclick="previewVoice('speaker1')">
                                üîä Preview Voice
                            </button>
                            <span id="speaker1PreviewStatus"></span>
                        </div>
                    </div>
                </div>

                <!-- Speaker 2 -->
                <div class="speaker-card">
                    <h3>üé≠ Speaker 2 (Secondary)</h3>
                    
                    <div class="form-group">
                        <label for="speaker2Name">Display Name</label>
                        <input type="text" id="speaker2Name" placeholder="e.g., Mike, Dr. Smith, Emma" value="StudentB">
                    </div>
                    
                    <div class="form-group">
                        <label for="speaker2Role">Role</label>
                        <select id="speaker2Role">
                            <option value="student" selected>Student</option>
                            <option value="teacher">Teacher</option>
                            <option value="narrator">Narrator</option>
                            <option value="co-host">Co-host</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="speaker2Personality">Personality</label>
                        <select id="speaker2Personality">
                            <option value="curious" selected>Curious</option>
                            <option value="friendly">Friendly</option>
                            <option value="inquisitive">Inquisitive</option>
                            <option value="supportive">Supportive</option>
                            <option value="energetic">Energetic</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="speaker2Voice">Voice Selection</label>
                        <select id="speaker2Voice">
                            <option value="">Loading voices...</option>
                        </select>
                        <div class="voice-preview">
                            <button type="button" class="btn btn-secondary" onclick="previewVoice('speaker2')">
                                üîä Preview Voice
                            </button>
                            <span id="speaker2PreviewStatus"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Audio Settings Section -->
        <div class="config-section">
            <h2 class="section-title">
                üîä Audio Configuration
            </h2>
            
            <div class="audio-controls">
                <div class="slider-group">
                    <label for="speakingRate">
                        Speaking Rate
                        <span class="value-display" id="speakingRateValue">1.0x</span>
                    </label>
                    <input type="range" id="speakingRate" class="slider" min="0.5" max="2.0" step="0.1" value="1.0">
                </div>

                <div class="slider-group">
                    <label for="pitch">
                        Pitch Adjustment
                        <span class="value-display" id="pitchValue">0 st</span>
                    </label>
                    <input type="range" id="pitch" class="slider" min="-10" max="10" step="0.5" value="0">
                </div>

                <div class="slider-group">
                    <label for="volumeGain">
                        Volume Gain
                        <span class="value-display" id="volumeGainValue">0 dB</span>
                    </label>
                    <input type="range" id="volumeGain" class="slider" min="-10" max="10" step="1" value="0">
                </div>

                <div class="form-group">
                    <label for="audioEncoding">Audio Format</label>
                    <select id="audioEncoding">
                        <option value="MP3" selected>MP3 (Recommended)</option>
                        <option value="LINEAR16">WAV (Uncompressed)</option>
                        <option value="OGG_OPUS">OGG Opus</option>
                        <option value="FLAC">FLAC (Lossless)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="sampleRate">Sample Rate</label>
                    <select id="sampleRate">
                        <option value="16000">16 kHz (Basic)</option>
                        <option value="22050">22 kHz (Good)</option>
                        <option value="24000">24 kHz (High)</option>
                        <option value="44100" selected>44 kHz (CD Quality)</option>
                        <option value="48000">48 kHz (Professional)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="effectsProfile">Audio Effects Profile</label>
                    <select id="effectsProfile">
                        <option value="headphone-class-device" selected>Headphones (Recommended)</option>
                        <option value="small-bluetooth-speaker-class-device">Small Speakers</option>
                        <option value="large-home-entertainment-class-device">Home Theater</option>
                        <option value="handset-class-device">Phone/Mobile</option>
                        <option value="telephony-class-application">Phone Call</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="actions">
            <button type="button" class="btn btn-secondary" onclick="resetToDefaults()">
                üîÑ Reset to Defaults
            </button>
            <button type="button" class="btn btn-primary" onclick="saveConfiguration()">
                üíæ Save Configuration
            </button>
            <button type="button" class="btn btn-success" onclick="testConfiguration()">
                üéµ Test Audio Generation
            </button>
        </div>
    </div>

    <script>
        // Configuration state
        let currentConfig = {
            speakers: {
                speaker1: {
                    name: 'StudentA',
                    role: 'student',
                    personality: 'confident',
                    voice: null
                },
                speaker2: {
                    name: 'StudentB',
                    role: 'student', 
                    personality: 'curious',
                    voice: null
                }
            },
            audio: {
                speakingRate: 1.0,
                pitch: 0,
                volumeGain: 0,
                audioEncoding: 'MP3',
                sampleRate: 44100,
                effectsProfile: 'headphone-class-device'
            }
        };

        // Available Google TTS voices (this would be loaded from API)
        const availableVoices = {
            'en-US': {
                'chirp3-hd': [
                    { name: 'en-US-Journey-O', gender: 'NEUTRAL', description: 'Premium educational voice' },
                    { name: 'en-US-Journey-D', gender: 'NEUTRAL', description: 'Premium educational voice (alt)' }
                ],
                'neural2': [
                    { name: 'en-US-Neural2-A', gender: 'FEMALE', description: 'Warm, clear female voice' },
                    { name: 'en-US-Neural2-C', gender: 'FEMALE', description: 'Professional female voice' },
                    { name: 'en-US-Neural2-D', gender: 'MALE', description: 'Authoritative male voice' },
                    { name: 'en-US-Neural2-F', gender: 'FEMALE', description: 'Friendly female voice' },
                    { name: 'en-US-Neural2-I', gender: 'MALE', description: 'Conversational male voice' },
                    { name: 'en-US-Neural2-J', gender: 'MALE', description: 'Clear male voice' }
                ],
                'wavenet': [
                    { name: 'en-US-Wavenet-A', gender: 'MALE', description: 'Standard male voice' },
                    { name: 'en-US-Wavenet-B', gender: 'MALE', description: 'Standard male voice (alt)' },
                    { name: 'en-US-Wavenet-C', gender: 'FEMALE', description: 'Standard female voice' },
                    { name: 'en-US-Wavenet-D', gender: 'MALE', description: 'Standard male voice (deep)' }
                ]
            }
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadVoiceOptions();
            setupSliderListeners();
            loadSavedConfiguration();
        });

        // Load voice options into dropdowns
        function loadVoiceOptions() {
            const speaker1Select = document.getElementById('speaker1Voice');
            const speaker2Select = document.getElementById('speaker2Voice');
            
            // Clear existing options
            speaker1Select.innerHTML = '';
            speaker2Select.innerHTML = '';
            
            // Add voice options
            Object.keys(availableVoices['en-US']).forEach(voiceType => {
                // Add group label
                const group1 = document.createElement('optgroup');
                group1.label = voiceType.toUpperCase();
                const group2 = document.createElement('optgroup');
                group2.label = voiceType.toUpperCase();
                
                availableVoices['en-US'][voiceType].forEach(voice => {
                    const option1 = document.createElement('option');
                    option1.value = voice.name;
                    option1.textContent = `${voice.name} (${voice.gender}) - ${voice.description}`;
                    group1.appendChild(option1);
                    
                    const option2 = document.createElement('option');
                    option2.value = voice.name;
                    option2.textContent = `${voice.name} (${voice.gender}) - ${voice.description}`;
                    group2.appendChild(option2);
                });
                
                speaker1Select.appendChild(group1);
                speaker2Select.appendChild(group2);
            });
            
            // Set default selections
            speaker1Select.value = 'en-US-Neural2-D'; // Male voice for Speaker 1
            speaker2Select.value = 'en-US-Neural2-A'; // Female voice for Speaker 2
        }

        // Setup slider listeners for real-time updates
        function setupSliderListeners() {
            const sliders = [
                { id: 'speakingRate', display: 'speakingRateValue', suffix: 'x' },
                { id: 'pitch', display: 'pitchValue', suffix: ' st' },
                { id: 'volumeGain', display: 'volumeGainValue', suffix: ' dB' }
            ];
            
            sliders.forEach(slider => {
                const element = document.getElementById(slider.id);
                const display = document.getElementById(slider.display);
                
                element.addEventListener('input', function() {
                    display.textContent = this.value + slider.suffix;
                });
            });
        }

        // Preview voice functionality
        async function previewVoice(speakerId) {
            const voiceSelect = document.getElementById(speakerId + 'Voice');
            const statusSpan = document.getElementById(speakerId + 'PreviewStatus');
            const voiceName = voiceSelect.value;
            
            if (!voiceName) {
                showStatus('Please select a voice first', 'error');
                return;
            }
            
            statusSpan.innerHTML = '<span class="loading"></span> Generating preview...';
            
            try {
                // This would make an API call to generate preview audio
                const response = await fetch('/api/v1/tts/preview', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        voice: voiceName,
                        text: `Hello! I'm ${document.getElementById(speakerId + 'Name').value}. This is how I'll sound in your educational episodes.`,
                        speakingRate: document.getElementById('speakingRate').value,
                        pitch: document.getElementById('pitch').value
                    })
                });
                
                if (response.ok) {
                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audio = new Audio(audioUrl);
                    audio.play();
                    statusSpan.textContent = '‚úÖ Playing preview';
                    
                    // Clear status after audio ends
                    audio.addEventListener('ended', () => {
                        statusSpan.textContent = '';
                    });
                } else {
                    throw new Error('Preview generation failed');
                }
            } catch (error) {
                statusSpan.textContent = '‚ùå Preview failed';
                showStatus('Voice preview failed. Please check your configuration.', 'error');
            }
        }

        // Save configuration
        async function saveConfiguration() {
            const config = gatherConfiguration();
            
            try {
                const response = await fetch('/api/v1/tts/config', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(config)
                });
                
                if (response.ok) {
                    showStatus('Configuration saved successfully!', 'success');
                    currentConfig = config;
                } else {
                    throw new Error('Save failed');
                }
            } catch (error) {
                showStatus('Failed to save configuration. Please try again.', 'error');
            }
        }

        // Test configuration with sample audio generation
        async function testConfiguration() {
            const config = gatherConfiguration();
            
            try {
                showStatus('Generating test audio with your configuration...', 'success');
                
                const response = await fetch('/api/v1/tts/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        config: config,
                        testScript: {
                            sections: [{
                                text: `${config.speakers.speaker1.name}: Welcome to our educational episode! Today we'll explore fascinating concepts together.\n\n${config.speakers.speaker2.name}: That sounds exciting! I'm curious to learn more about this topic.`
                            }]
                        }
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showStatus('Test audio generated successfully! Check the outputs folder.', 'success');
                } else {
                    throw new Error('Test generation failed');
                }
            } catch (error) {
                showStatus('Test audio generation failed. Please check your configuration and API keys.', 'error');
            }
        }

        // Gather current configuration from form
        function gatherConfiguration() {
            return {
                speakers: {
                    speaker1: {
                        name: document.getElementById('speaker1Name').value,
                        role: document.getElementById('speaker1Role').value,
                        personality: document.getElementById('speaker1Personality').value,
                        voice: document.getElementById('speaker1Voice').value
                    },
                    speaker2: {
                        name: document.getElementById('speaker2Name').value,
                        role: document.getElementById('speaker2Role').value,
                        personality: document.getElementById('speaker2Personality').value,
                        voice: document.getElementById('speaker2Voice').value
                    }
                },
                audio: {
                    speakingRate: parseFloat(document.getElementById('speakingRate').value),
                    pitch: parseFloat(document.getElementById('pitch').value),
                    volumeGain: parseFloat(document.getElementById('volumeGain').value),
                    audioEncoding: document.getElementById('audioEncoding').value,
                    sampleRate: parseInt(document.getElementById('sampleRate').value),
                    effectsProfile: document.getElementById('effectsProfile').value
                }
            };
        }

        // Reset to default values
        function resetToDefaults() {
            if (confirm('Are you sure you want to reset all settings to defaults?')) {
                document.getElementById('speaker1Name').value = 'StudentA';
                document.getElementById('speaker2Name').value = 'StudentB';
                document.getElementById('speaker1Role').value = 'student';
                document.getElementById('speaker2Role').value = 'student';
                document.getElementById('speaker1Personality').value = 'confident';
                document.getElementById('speaker2Personality').value = 'curious';
                document.getElementById('speakingRate').value = 1.0;
                document.getElementById('pitch').value = 0;
                document.getElementById('volumeGain').value = 0;
                document.getElementById('audioEncoding').value = 'MP3';
                document.getElementById('sampleRate').value = 44100;
                document.getElementById('effectsProfile').value = 'headphone-class-device';
                
                // Update displays
                document.getElementById('speakingRateValue').textContent = '1.0x';
                document.getElementById('pitchValue').textContent = '0 st';
                document.getElementById('volumeGainValue').textContent = '0 dB';
                
                showStatus('Settings reset to defaults', 'success');
            }
        }

        // Load saved configuration
        async function loadSavedConfiguration() {
            try {
                const response = await fetch('/api/v1/tts/config');
                if (response.ok) {
                    const config = await response.json();
                    // Populate form with saved values
                    // ... populate form fields ...
                }
            } catch (error) {
                console.log('No saved configuration found, using defaults');
            }
        }

        // Show status messages
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.className = `status-message status-${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>